"use strict";function onGoogleReady(){angular.bootstrap(document.body,["mapTweetInfoApp"])}!function(){var a=angular.module("mapTweetInfoApp",["ngResource","ngRoute","ngAnimate","searchControllers","resultsControllers","historyControllers","latLngServices","twitterSearchServices","mapServices","historyServices","ngEnterDirectives","tweetDirectives","historyDirectives","ui.bootstrap","ui.map","mapDirectives","navControllerModule"]);a.config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"html/partials/search.html",controller:"searchCtrl"}).when("/search/:searchId",{templateUrl:"html/partials/searchResults.html",controller:"resultsCtrl"}).when("/history",{templateUrl:"html/partials/history.html",controller:"historyCtrl",resolve:{searchHistory:["historyFactory",function(a){return a.retrieveSearchHistory()}]}}).when("/about",{templateUrl:"html/partials/about.html"}).otherwise({redirectTo:"/"})}])}(),$(document).ready(function(){$(document).on("click","[data-toggle=offcanvas]",function(){$(".row-offcanvas").toggleClass("active")})}),function(){var a=angular.module("historyControllers",[]);a.controller("historyCtrl",["$scope","$modal","historyFactory","searchHistory",function(a,b,c,d){a.user=d,a.submittingRemoveAll=!1,console.log("searchHistory-",a.user.geo_searches),a.openConfirmRemoveAll=function(){var d=b.open({templateUrl:"confirmRemoveAll.html",controller:"confirmRemoveCtrl",size:"sm"});d.result.then(function(){a.submittingRemoveAll=!0,c.removeAll().then(function(b){(b="removed")&&(a.user.geo_searches=[],a.submittingRemoveAll=!1)})})}}]),a.controller("confirmRemoveCtrl",["$scope","$modalInstance",function(a,b){a.confirmRemoveAll=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}])}(),function(){angular.module("navControllerModule",[]).controller("navCtrl",["$scope","$http",function(a,b){b.get("/api/user").success(function(b){a.user=b})}])}(),function(){var a=angular.module("resultsControllers",["ngSanitize"]);a.controller("resultsCtrl",["$scope","$routeParams","factoryTwitterSearch","markerFactory","$window",function(a,b,c,d){a.mapOptions={center:new google.maps.LatLng(20,-30),zoom:2,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,panControl:!1,zoomControl:!0,scaleControl:!1,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.RIGHT_BOTTOM},styles:[{featureType:"all",stylers:[{saturation:0},{hue:"#e7ecf0"}]},{featureType:"road",stylers:[{saturation:-70}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"},{saturation:-60}]}]},a.myMarkers=[],a.currentMarkerInfo={},a.currentMarkerInfo.user={},a.searchId=b.searchId,a.search={},a.filter={},a.results={},a.results.tweets=[],a.results.geoTweets=[],a.results.returned=!1,c.getTweetsBySearchId(b.searchId).then(function(b){a.search=b.search,d.setMyMap(a.myMap),a.results.tweets=b.statuses,angular.forEach(a.results.tweets,function(a){var b=a.created_at.split(" ");a.created_at=[b[1],b[2],b[3],b[5]].join(" ")}),a.results.geoTweets=a.results.tweets.filter(function(a){return null!=a.geo});for(var c=0;c<a.results.geoTweets.length;c++){var e=d.createAndAddMarker(a.results.geoTweets[c].geo[0],a.results.geoTweets[c].geo[1]);a.results.geoTweets[c].marker=e,a.myMarkers.push(a.results.geoTweets[c].marker)}}).then(function(){if(0==a.results.geoTweets.length)a.myMap.setCenter({lat:+a.search.latitude,lng:+a.search.longitude}),a.myMap.setZoom(14),a.results.returned=!0;else{a.results.returned=!0;var b=new google.maps.LatLngBounds;a.myMarkers.forEach(function(a){b.extend(a.getPosition())}),a.myMap.setCenter(b.getCenter()),a.myMap.fitBounds(b),a.myMap.getZoom()>=17&&a.myMap.setZoom(16)}}),a.openMarkerInfo=function(b){a.currentMarkerInfo.marker=b;var c=a.results.geoTweets.filter(function(a){return a.marker==b})[0];a.currentMarkerInfo.user=c.user,a.currentMarkerInfo.created_at=c.created_at,a.currentMarkerInfo.text=c.text,a.myInfoWindow.open(a.myMap,b)},a.panToMarkerOpenInfo=function(b){b.geo&&(a.currentMarkerInfo.user=b.user,a.currentMarkerInfo.created_at=b.created_at,a.currentMarkerInfo.text=b.text,a.currentMarkerInfo.marker=b.marker,a.myInfoWindow.open(a.myMap,b.marker),a.myMap.panTo(b.marker.getPosition()))}}])}(),function(){var a=angular.module("searchControllers",[]);a.controller("searchCtrl",["$scope","$location","factoryLatLng","factoryTwitterSearch",function(a,b,c,d){a.counts=[{label:"25 Tweets",value:"25"},{label:"50 Tweets",value:"50"},{label:"75 Tweets",value:"75"},{label:"150 Tweets",value:"150"}],a.search={},a.search.query="",a.search.count="50",a.search.location="",a.search.radius=25,a.search.radiusUnit="Km",a.search.useCurrentLocation="Use My Current Location",a.search.usedCurrentLocation=!1,a.search.retrievingCurrentLoc=!1,a.submittingSearch=!1,a.gotLatLng=!1;for(var e in b.search())b.search().hasOwnProperty(e)&&(a.search[e]="radius"===e?parseInt(b.search()[e]):b.search()[e]);a.changeRadiusUnit=function(b){a.search.radiusUnit=b},a.getGeo=function(b){""!=b&&c.getLatLng(b).then(function(b){a.search.latitude=b.geo.lat,a.search.longitude=b.geo.lng,a.search.location=b.formattted_address,a.gotLatLng=!0})},a.queryLocations=function(a){return c.queryLocations(a)},a.getCurrentLocation=function(){a.search.retrievingCurrentLoc=!0,a.search.useCurrentLocation="Retrieving Current Location...",c.getCurrentLocation(function(b){b.notSupported?a.search.useCurrentLocation="Unable to use My Location":(c.reverseGeocode(b.latitude,b.longitude,function(b){a.search.location=b,a.$apply()}),a.search.latitude=b.latitude,a.search.longitude=b.longitude,a.search.usedCurrentLocation=!0,a.search.retrievingCurrentLoc=!1,a.search.useCurrentLocation="Use My Current Location",a.$apply())})},a.submitSearch=function(){a.submittingSearch=!0,d.postTwitterSearch(a.search)}}])}(),function(){angular.module("historyDirectives",[]).directive("searchHistory",[function(){return{restrict:"E",templateUrl:"html/templates/searchHistory.html",scope:{geoSearches:"=geoSearches",searchFilter:"=searchFilter"},controller:["$scope","historyFactory",function(a,b){console.log("directive geoSearches-",a.geoSearches),a.performSearch=function(a){b.performSearch(a._id)},a.copyToSearch=function(a){b.copyToSearch(a)},a.removeSearch=function(c){b.removeSearch(c._id).then(function(b){"removed"===b&&a.geoSearches.splice(a.geoSearches.indexOf(c),1)})}}]}}])}(),function(){angular.module("mapDirectives",[]).directive("uiMap",["$window",function(a){return{restrict:"A",link:function(b,c){c.height(a.outerHeight-200)}}}])}(),function(){angular.module("ngEnterDirectives",[]).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){angular.module("tweetDirectives",[]).directive("tweetPanel",[function(){return{restrict:"E",templateUrl:"html/templates/tweetPanel.html",scope:{tweet:"="}}}])}(),function(){var a=angular.module("historyServices",[]);a.factory("historyFactory",["$http","$location",function(a,b){return{removeAll:function(){return a.delete("/api/search/all").then(function(a){return 200===a.status&&"removed"===a.data?"removed":void 0})},retrieveSearchHistory:function(){return a.get("/api/search/history").then(function(a){return a.data})},copyToSearch:function(a){b.path("/").search({location:a.location,radius:a.radius,radiusUnit:a.radiusUnit,query:a.query,latitude:a.latitude,longitude:a.longitude})},performSearch:function(a){b.path("/search/"+a)},removeSearch:function(b){return a.delete("/api/search",{params:{searchId:b}}).then(function(a){return 200===a.status&&"removed"===a.data?"removed":void 0})}}}])}(),function(){var a=angular.module("latLngServices",[]);a.factory("factoryLatLng",["$http",function(a){return{reverseGeocode:function(a,b,c){var d=new google.maps.Geocoder,e=new google.maps.LatLng(+a,+b);d.geocode({latLng:e},function(a,b){if(b==google.maps.GeocoderStatus.OK){if(a[1])return void c(a[1].formatted_address);c(a[0].formatted_address)}})},getLatLng:function(b){return a.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:b,sensor:!1}}).then(function(a){return{geo:a.data.results[0].geometry.location,formattted_address:a.data.results[0].formatted_address}})},queryLocations:function(b){return a.get("http://maps.googleapis.com/maps/api/geocode/json",{params:{address:b,sensor:!1}}).then(function(a){var b=[];return angular.forEach(a.data.results,function(a){b.push(a.formatted_address)}),b})},getCurrentLocation:function(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a(b.coords)}):a({notSupported:!0})}}}])}(),function(){var a=angular.module("mapServices",[]);a.factory("markerFactory",[function(){var a=null;return{setMyMap:function(b){a=b},createAndAddMarker:function(b,c){var d=new google.maps.Marker({map:a,position:new google.maps.LatLng(b,c),icon:"../../img/bird_blue_32.png"});return d},getMyMap:function(){return a}}}])}(),function(){var a=angular.module("twitterSearchServices",[]);a.factory("factoryTwitterSearch",["$http","$location",function(a,b){return{postTwitterSearch:function(c){a.post("/api/search",c).success(function(a){var c=a._id;b.path("/search/"+c)})},getTweetsBySearchId:function(b){return a.get("/api/search?searchId="+b).then(function(a){return a.data})}}}])}();
//# sourceMappingURL=app.min.js.map